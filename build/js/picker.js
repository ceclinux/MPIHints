!function(e){"function"==typeof define&&define.amd?define("picker",["jquery"],e):this.Picker=e(jQuery)}(function(e){function t(o,r,i,a){function c(){return t._.node("div",t._.node("div",t._.node("div",t._.node("div",m.component.nodes(d.open),p.box),p.wrap),p.frame),p.holder)}function s(e){e.stopPropagation(),"focus"==e.type&&m.$root.addClass(p.focused),m.open()}if(!o)return t;var d={id:Math.abs(~~(1e9*Math.random()))},u=i?e.extend(!0,{},i.defaults,a):a||{},p=e.extend({},t.klasses(),u.klass),f=e(o),l=function(){return this.start()},m=l.prototype={constructor:l,$node:f,start:function(){return d&&d.start?m:(d.methods={},d.start=!0,d.open=!1,d.type=o.type,o.autofocus=o==document.activeElement,o.type="text",o.readOnly=!u.editable,m.component=new i(m,u),m.$root=e(t._.node("div",c(),p.picker)).on({focusin:function(e){m.$root.removeClass(p.focused),e.stopPropagation()},"mousedown click":function(t){var n=t.target;n!=m.$root.children()[0]&&(t.stopPropagation(),"mousedown"!=t.type||e(n).is(":input")||"OPTION"==n.nodeName||(t.preventDefault(),o.focus()))}}).on("click","[data-pick], [data-nav], [data-clear]",function(){var n=e(this),r=n.data(),i=n.hasClass(p.navDisabled)||n.hasClass(p.disabled),a=document.activeElement;a=a&&(a.type||a.href),(i||a&&!e.contains(m.$root[0],a))&&o.focus(),r.nav&&!i?m.set("highlight",m.component.item.highlight,{nav:r.nav}):t._.isInteger(r.pick)&&!i?m.set("select",r.pick).close(!0):r.clear&&m.clear().close(!0)}),u.formatSubmit&&(m._hidden=e('<input type=hidden name="'+("string"==typeof u.hiddenPrefix?u.hiddenPrefix:"")+o.name+("string"==typeof u.hiddenSuffix?u.hiddenSuffix:"_submit")+'"'+(f.data("value")||o.value?' value="'+t._.trigger(m.component.formats.toString,m.component,[u.formatSubmit,m.component.item.select])+'"':"")+">")[0]),f.data(r,m).addClass(p.input).val(f.data("value")?t._.trigger(m.component.formats.toString,m.component,[u.format,m.component.item.select]):o.value).after(m._hidden).on("focus.P"+d.id+" click.P"+d.id,s).on("change.P"+d.id,function(){m._hidden&&(m._hidden.value=o.value?t._.trigger(m.component.formats.toString,m.component,[u.formatSubmit,m.component.item.select]):"")}),u.editable||f.on("keydown.P"+d.id,function(e){var t=e.keyCode,n=/^(8|46)$/.test(t);return 27==t?(m.close(),!1):void((32==t||n||!d.open&&m.component.key[t])&&(e.preventDefault(),e.stopPropagation(),n?m.clear().close():m.open()))}),u.container?e(u.container).append(m.$root):f.after(m.$root),m.on({start:m.component.onStart,render:m.component.onRender,stop:m.component.onStop,open:m.component.onOpen,close:m.component.onClose,set:m.component.onSet}).on({start:u.onStart,render:u.onRender,stop:u.onStop,open:u.onOpen,close:u.onClose,set:u.onSet}),o.autofocus&&m.open(),m.trigger("start").trigger("render"))},render:function(e){return e?m.$root.html(c()):m.$root.find("."+p.box).html(m.component.nodes(d.open)),m.trigger("render")},stop:function(){return d.start?(m.close(),m._hidden&&m._hidden.parentNode.removeChild(m._hidden),m.$root.remove(),f.removeClass(p.input).removeData(r),setTimeout(function(){f.off(".P"+d.id)},0),o.type=d.type,o.readOnly=!1,m.trigger("stop"),d.methods={},d.start=!1,m):m},open:function(r){return d.open?m:(f.addClass(p.active),m.$root.addClass(p.opened),r!==!1&&(d.open=!0,f.trigger("focus"),n.on("click.P"+d.id+" focusin.P"+d.id,function(e){var t=e.target;t!=o&&t!=document&&m.close(t===m.$root.children()[0])}).on("keydown.P"+d.id,function(n){var r=n.keyCode,i=m.component.key[r],a=n.target;27==r?m.close(!0):a!=o||!i&&13!=r?e.contains(m.$root[0],a)&&13==r&&(n.preventDefault(),a.click()):(n.preventDefault(),i?t._.trigger(m.component.key.go,m,[t._.trigger(i)]):m.$root.find("."+p.highlighted).hasClass(p.disabled)||m.set("select",m.component.item.highlight).close())})),m.trigger("open"))},close:function(e){return e&&(f.off("focus.P"+d.id).trigger("focus"),setTimeout(function(){f.on("focus.P"+d.id,s)},0)),f.removeClass(p.active),m.$root.removeClass(p.opened+" "+p.focused),d.open?(d.open=!1,n.off(".P"+d.id),m.trigger("close")):m},clear:function(){return m.set("clear")},set:function(n,o,r){var i,a,c=e.isPlainObject(n),s=c?n:{};if(r=c&&e.isPlainObject(o)?o:r||{},n){c||(s[n]=o);for(i in s)a=s[i],m.component.item[i]&&m.component.set(i,a,r),("select"==i||"clear"==i)&&f.val("clear"==i?"":t._.trigger(m.component.formats.toString,m.component,[u.format,m.component.get(i)])).trigger("change");m.render()}return r.muted?m:m.trigger("set",s)},get:function(e,n){return e=e||"value",null!=d[e]?d[e]:"value"==e?o.value:m.component.item[e]?"string"==typeof n?t._.trigger(m.component.formats.toString,m.component,[n,m.component.get(e)]):m.component.get(e):void 0},on:function(t,n){var o,r,i=e.isPlainObject(t),a=i?t:{};if(t){i||(a[t]=n);for(o in a)r=a[o],d.methods[o]=d.methods[o]||[],d.methods[o].push(r)}return m},trigger:function(e,n){var o=d.methods[e];return o&&o.map(function(e){t._.trigger(e,m,[n])}),m}};return new l}var n=e(document);return t.klasses=function(e){return e=e||"picker",{picker:e,opened:e+"--opened",focused:e+"--focused",input:e+"__input",active:e+"__input--active",holder:e+"__holder",frame:e+"__frame",wrap:e+"__wrap",box:e+"__box"}},t._={group:function(e){for(var n,o="",r=t._.trigger(e.min,e);r<=t._.trigger(e.max,e,[r]);r+=e.i)n=t._.trigger(e.item,e,[r]),o+=t._.node(e.node,n[0],n[1],n[2]);return o},node:function(t,n,o,r){return n?(n=e.isArray(n)?n.join(""):n,o=o?' class="'+o+'"':"",r=r?" "+r:"","<"+t+o+r+">"+n+"</"+t+">"):""},lead:function(e){return(10>e?"0":"")+e},trigger:function(e,t,n){return"function"==typeof e?e.apply(t,n||[]):e},digits:function(e){return/\d/.test(e[1])?2:1},isDate:function(e){return{}.toString.call(e).indexOf("Date")>-1&&this.isInteger(e.getDate())},isInteger:function(e){return{}.toString.call(e).indexOf("Number")>-1&&e%1===0}},t.extend=function(n,o){e.fn[n]=function(r,i){var a=this.data(n);return"picker"==r?a:a&&"string"==typeof r?(t._.trigger(a[r],a,[i]),this):this.each(function(){var i=e(this);i.data(n)||new t(this,n,o,r)})},e.fn[n].defaults=o.defaults},t});