!function(t){function e(e,n){this.element=t(e),this.options=t.extend({},s,n),this._defaults=s,this._name=a,this.init()}var a="Calendar",s={weekStart:1,msg_days:["Su","Mo","Tu","We","Th","Fr","Sa"],msg_months:["January","February","March","April","May","June","July","August","September","October","November","December"],msg_today:"Today",msg_events_header:"Events Today",events:null},n='<h1 class="year"></h1><h3 class="month"></h3><table class="calendar" id="calendar"><thead class="calendar-header"></thead><tbody class="calendar-body"></tbody><tfoot><th colspan="2" class="sel" id="last"><div class="arrow"><i class="icon-arrow-left"></i></div></th><th colspan="3" class="sel" id="current">'+s.msg_today+'</th><th colspan="2" class="sel" id="next"><div class="arrow"><i class="icon-arrow-right"></i></div></th></tfoot></table>',i=[31,28,31,30,31,30,31,31,30,31,30,31],r=new Date;e.prototype.init=function(){this.weekStart=this.options.weekStart||1,this.days=this.options.msg_days,this.months=this.options.msg_months,this.msg_events_hdr=this.options.msg_events_header,this.events=this.options.events,this.calendar=t(n).appendTo(this.element).on({click:t.proxy(this.click,this)}),this.live_date=new Date;var e=new Date;this.mm=e.getMonth(),this.yy=e.getFullYear();var a=new Date(this.yy,this.mm,1);this.yp=a.getFullYear(),this.yn=a.getFullYear(),this.component?this.component.on("click",t.proxy(this.show,this)):this.element.on("click",t.proxy(this.show,this)),this.renderCalendar(e)},e.prototype.renderEvents=function(e,a){for(var s=this.live_date,n=this.msg_events_hdr,r=0;r<i[s.getMonth()];r++)t.each(e.event,function(){var t=1900+s.getYear(),e=s.getMonth(),i=new Date(t,e,0==r?1:r,0,0,0,0),h=new Date(this.date);h.getDate()==i.getDate()&&h.getMonth()==i.getMonth()&&h.getFullYear()==i.getFullYear()&&a.parent("div:first").find("#day_"+r).removeClass("day").addClass("holiday").empty().append('<span class="weekday">'+r+"</span>").popover({title:n,content:"You have "+this.title+" appointments",delay:{show:250,hide:250}})})},e.prototype.loadEvents=function(){null!==this.events&&"function"==typeof this.events&&this.renderEvents(this.events.apply(this,[]),this.calendar)},e.prototype.renderCalendar=function(t){{var e=new Date(this.yy,this.mm,1);this.live_date}this.element.parent("div:first").find(".year").empty(),this.element.parent("div:first").find(".month").empty(),this.element.parent("div:first").find(".year").append(e.getFullYear()),this.element.parent("div:first").find(".month").append(this.months[e.getMonth()]),i[1]=this.isLeapYear(t.getYear())?29:28,this.calendar.find(".calendar-header").empty(),this.calendar.find(".calendar-body").empty(),this.renderDays();for(var a=e.getDay(),s=0,n=0,h=0,d=0;d>=h;d++){for(var o="",l=this.weekStart;l<this.days.length+this.weekStart;l++)cls="",msg="",id="",n>=i[e.getMonth()]?s=0:(s%7>0&&n%7>0||l%7==a%7)&&(s++,n++),s==i[e.getMonth()]&&(h=i[e.getMonth()]),0==cls.length&&(cls=r.getDate()==t.getDate()&&s==t.getDate()&&t.getMonth()==t.getMonth()&&t.getFullYear()==t.getFullYear()?"today":l%7==0||l%7==6?"weekend":"day"),id="day_"+s,month_=t.getMonth()+1,year=t.getFullYear(),o+=0==s?"<td>&nbsp;</td>":msg.length>0?'<td class="'+cls+'" id="'+id+'" year="'+year+'" month="'+month_+'" day="'+s+'"><span class="weekday">'+s+"</span></td>":'<td class="'+cls+'" id="'+id+'" year="'+year+'" month="'+month_+'" day="'+s+'">'+s+"</td>";o="<tr>"+o+"</tr>",this.calendar.find(".calendar-body").append(o)}this.loadEvents()},e.prototype.renderDays=function(){for(var t="",e=this.weekStart;e<this.weekStart+7;e++)t+="<th>"+this.days[e%7]+"</th>";var a="<tr>"+t+"</tr>";this.calendar.find(".calendar-header").append(a)},e.prototype.click=function(e){e.stopPropagation(),e.preventDefault();var a=t(e.target).closest("td, th");if(1==a.length)switch(a[0].nodeName.toLowerCase()){case"td":if(a.is(".day")){var s=parseInt(a.attr("day"),10)||1,n=parseInt(a.attr("month"),10)||1,i=parseInt(a.attr("year"),10)||1;this.element.trigger({type:"changeDay",day:s,month:n,year:i})}else if(a.is(".holiday")){var s=parseInt(a.attr("day"),10)||1,n=parseInt(a.attr("month"),10)||1,i=parseInt(a.attr("year"),10)||1;this.element.trigger({type:"onEvent",day:s,month:n,year:i})}else if(a.is(".today")){var s=parseInt(a.attr("day"),10)||1,n=parseInt(a.attr("month"),10)||1,i=parseInt(a.attr("year"),10)||1;this.element.trigger({type:"changeDay",day:s,month:n,year:i})}break;case"th":if(a.is(".sel"))switch(a.attr("id")){case"last":this.update_date("prv");var r=new Date(this.yp,this.mm,1);this.live_date=r,this.renderCalendar(r,this.events),this.element.trigger({type:"onPrev"});break;case"current":this.update_date("crt");var h=new Date;this.live_date=h,this.renderCalendar(h,this.events),this.element.trigger({type:"onCurrent"});break;case"next":this.update_date("nxt");var d=new Date(this.yn,this.mm,1);this.live_date=d,this.renderCalendar(d,this.events),this.element.trigger({type:"onNext"})}}},e.prototype.update_date=function(t){var e=new Date;switch(t){case"prv":e=new Date(this.yy,this.mm-1,1);break;case"nxt":e=new Date(this.yy,this.mm+1,1);break;case"crt":}this.mm=e.getMonth(),this.yy=e.getFullYear();var a=new Date(this.yy,this.mm,1);this.yp=a.getFullYear(),this.yn=a.getFullYear()},e.prototype.isLeapYear=function(t){return t%4===0&&t%100!==0||t%400===0},t.fn[a]=function(s){return this.each(function(){t.data(this,"plugin_"+a)||t.data(this,"plugin_"+a,new e(this,s))})}}(jQuery,window,document);